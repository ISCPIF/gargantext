

<div class="pagination">
    <span class="step-links">
        {% if documents.has_previous %}
            <a style="cursor: pointer;" onclick="updateDocuments({{ documents.previous_page_number }},true);">previous</a>
        {% endif %}

        <div id="currentpage" style="display: none;">{{ documents.number }}</div>
        <span class="current">
            <strong>Page {{ documents.number }}</strong> of {{ documents.paginator.num_pages }}.
        </span>

        {% if documents.has_next %}
            <a style="cursor: pointer;" onclick="updateDocuments({{ documents.next_page_number }},true);">next</a>
        {% endif %}
    </span>
</div>

{% if documents %}

<ul>
{% for doc in documents %}
    {% if doc.date %}
    <li><div id="doc_{{doc.id}}"> <b>{{ doc.date }}</b>: <a target="_blank" href="/nodeinfo/{{doc.id}}">{{ doc.name}}</a> , @ {{ doc.metadata.source}}</div></li>
    {% endif %}
{% endfor %}


          <div id="delAll" style="visibility: hidden;">
							<center>
              <button onclick="deleteDuplicates(theurl);">Delete all Duplicates in one click</button>
							</center>
          </div>


</ul>

<script>

function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function deleteDuplicates(url) {
    console.log("hello world")
    console.log(url)
    $.ajax({
      url: url,
      type: 'DELETE',
      beforeSend: function(xhr) {
        xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
      },
      success: function(data) {
        console.log("in DeleteDuplicates")
        console.log(data)
        location.reload();
      },
        error: function(result) {
            console.log("Data not found");
            console.log(result)
        }
    });
}

function deleteNode(node_id) {
    $.ajax({
        url: '/api/nodes/'+node_id,
        type: 'DELETE',
        beforeSend: function(xhr) {
            xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
        },
        success: function(result) {
            console.log("deleting: ")
            console.log(current_docs[node_id])
            var title = current_docs[node_id]
            console.log(result)
            var currentpage = $("#currentpage").html()
            console.log("vaciando div de subcorpus")
            $("#divsubcorpus").html("")
            console.log("before:")
            console.log(BIS_dict[title])
            BIS_dict[title][0]--;
            BIS_dict[title][1]++;
            console.log("after:")
            console.log(BIS_dict[title])
            // updateDocuments( currentpage , true );
            console.log("after delete:     updateDocuments( "+currentpage+" , true )")
            updateDocuments( currentpage , true )
            // $.when(  updateDocuments( currentpage , true )  ).done(function(a1) {
            //     console.log("inside the wheeeeen")
            //     console.log(BIS_dict[title])
            //     if(BIS_dict[title][0] == BIS_dict[title][1]) {

            //         $.doTimeout( 1000, function(){
            //             var elems = current_docs[title]
            //             for (var i in elems ) {
            //                 var id = elems[i]
            //                 console.log("deleting icons for :"+"#delete_"+id)
            //                 $("#delete_"+id).remove();  
            //             }
            //         });
            //     }
            //     // // // if(BIS_dict[title][0] == BIS_dict[title][1])
            //     // // //     $("#delete_"+node_id).remove();         
            //     // // current_docs = []
            //     // {% for doc in documents %}
            //     //     id = "doc_{{doc.id}}"
            //     //     title = "{{doc.name}}"
            //     //     console.log(BIS_dict[title])
            //     //     if(BIS_dict[title] && BIS_dict[title][0] > BIS_dict[title][1]) {
            //     //         var del_img = '<span id="delete_{{doc.id}}"><a title="Delete this document!" style="cursor: pointer;" onclick="deleteNode('+"{{doc.id}}"+',\''+title+'\')"><img width="20px" src="/static/img/delete-big.png"></img></a><span>'
            //     //         $("#"+id).prepend( del_img )
            //     //     }
            //     // {% endfor %}
            // });

        },
        error: function(result) {
            console.log("Data not found");
            console.log(result)
        }
    });
}



//'+"{{doc.id}}"+',\"'+title+'\"

current_docs = {}
if(Object.keys(BIS_dict).length>0) {
    $("#delAll").css("visibility", "visible"); 
    $("#delAll").show();
} else $("#delAll").remove()

{% for doc in documents %}
    id = "doc_{{doc.id}}"
    title = $("<div/>").html("{{doc.name}}").text()
    current_docs["{{doc.id}}"] = title;
    if(BIS_dict[title] && BIS_dict[title][0] > BIS_dict[title][1]) {
        jspart = 'onclick= "deleteNode( {{doc.id}} );"'
        var del_img = '<a title="Delete this document!" style="cursor: pointer;" '+jspart+'><img width="20px" src="/static/img/delete-big.png"></img></a>'
        $("#"+id).prepend( del_img )
    }
{% endfor %}

</script>
{% endif %}
